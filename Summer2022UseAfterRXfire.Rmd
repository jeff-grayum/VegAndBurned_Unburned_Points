---
title: "Summer2022UseAfterRXfire"
output: html_document
date: "2023-09-21"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Loading libraries
```{r}
#### Libraries ####

library(janitor)
library(tidyverse)
library(ggthemes)
library(lubridate)
library(lme4)
library(readxl)
library(writexl)
library(sf)
library(MuMIn)
library(scales)
library(sjPlot)
library(rsq)
library(betareg)
library(broom)
library(caret)
library(janitor)
library(performance)
library(gam)
library(mgcv)
theme_set(theme_minimal())
```

Importing locations
```{r}
#### Importing locations ####

#Importing summer locations, already joined with veg data and birds online.
summer2022_locs_veg_data <- read_xlsx("/Volumes/Samsung_T5/BOBWHITE_DATA/Clean/SummerLocations/Summer2022/summer_2022_points_veg_CorrectBirdsOnline.xlsx") %>%
  mutate(date = ymd(date)) %>%
  dplyr::filter(status != "D") 

#Adding in age/sex of each bird. May be useful
#The fate spreadsheet has age and sex info for each bird.
#Importing "fate" spreadsheet
fate <- rio::import("/Volumes/Samsung_T5/BOBWHITE_DATA/Clean/Fate/fate_clean_2021_22.xlsx", setclass = "tibble") %>%
  clean_names() %>%
  rename(band_numb = band_number) 

#Now we bind age and sex into locations, based on band_numb
summer2022_locs_veg_data <- summer2022_locs_veg_data %>%
  left_join(fate %>% 
              dplyr::select(band_numb, age, sex), 
            by = "band_numb")

veg_data_2022 <- read_xlsx("/Volumes/Samsung_T5/BOBWHITE_DATA/Clean/VegSurveys/VegSurveys2022.xlsx") %>%
  clean_names()

```

Determining proportion of birds in burn areas each day.
```{r}
#### Determining proportion of birds located in burned areas daily ####
# Counting unique birds signaled within a burned area each day
birds_in_burned_areas <- summer2022_locs_veg_data %>%
  dplyr::filter(burned == 1) %>%
  group_by(date) %>%
  summarize(birds_in_burned_areas = n_distinct(band_numb))


# Joining into summer locs data
summer2022_locs_veg_data <- summer2022_locs_veg_data %>%
  left_join(birds_in_burned_areas, by = "date")

# Handling NA values for birds_in_burned_areas
summer2022_locs_veg_data$birds_in_burned_areas[is.na(summer2022_locs_veg_data$birds_in_burned_areas)] <- 0

# Calculate percentage of birds in burned areas
s22rx <- summer2022_locs_veg_data %>%
  mutate(pib = (birds_in_burned_areas / birds_online))

# Handling NA values for pib
s22rx$pib[is.na(s22rx$pib)] <- 0


ave_burned_per_week <- s22rx %>%
  group_by(week) %>%
  summarize(mean_per_burned = mean(pib))
```


Lets add a distance to edge column for our points 
```{r}
#### Importing map of burned areas, calculating distance ####

#Importing map of burned areas, summer 2022.
#Reading burn compartments in again, but as an sf object
burn_compartments_2022 <- st_read("/Volumes/Samsung_T5/BOBWHITE_DATA/Maps/2022_burn_compartments/Polygons/NoAG_NoHW/2022_burn_units_NoAG_NoHW.shp")

# Converting burn_compartments_2022 polygons to line geometries that represent their boundaries. This is necessary to calc min distances later.
burn_compartment_boundaries <- st_boundary(burn_compartments_2022)

# Converting tibble of points to an sf object
summer2022_locs_sf <- st_as_sf(s22rx, coords = c("easting", "northing"), crs = st_crs(burn_compartments_2022))

# Calculating the distance from each point to the nearest line boundary of the burn compartments, storing it in matrix
distance_matrix <- st_distance(summer2022_locs_sf, burn_compartment_boundaries)

# Applying the function min() to each row (1 does this -- we'd use 2 for columns) in the distance matrix
min_distances <- apply(distance_matrix, 1, min)

# Add the minimum distance to the original tibble as a new column
s22rx$distance_to_edge <- min_distances


#This looks right, and similar to what we got in other analysis.
s22rx %>%
  dplyr::filter(burned == 1) %>%
  ggplot(aes(date, distance_to_edge)) +
  geom_point() +
  geom_smooth() +
  labs(x = "DSF",
       y = "Distance to edge (m)",
       title = "Distance to edge following prescribed fire",
       subtitle = "Only looking at birds within burned units")

s22rx %>%
  dplyr::filter(burned == 1) %>%
  summarize(mean_distance = mean(distance_to_edge))


s22rx %>%
  dplyr::filter(burned == 1) %>%
  ggplot(aes(distance_to_edge)) +
  geom_histogram(binwidth = 10, fill = "midnight blue", alpha = 0.8) + 
  geom_vline(xintercept = 28, linetype = "dashed", color = "gray") +
  labs(x = "Distance to edge",
       y = "",
       title = "Distances to edge following prescribed fire",
       subtitle = "Only looking at birds within burn compartments")

  

s22rx %>%
  dplyr::filter(burned == 0) %>%
  ggplot(aes(date, distance_to_edge)) +
  geom_point() +
  geom_smooth() +
  labs(x = "DSF",
       y = "Distance to edge",
       title = "Distance to edge of burned compartments following prescribed fire",
       subtitle = "Only looking at birds located in unburned units")

s22rx %>%
  dplyr::filter(burned == 0) %>%
  summarize(mean_distance = mean(distance_to_edge))


s22rx %>%
  dplyr::filter(burned == 0) %>%
  ggplot(aes(distance_to_edge)) +
  geom_histogram(binwidth = 20, fill = "midnight blue", alpha = 0.8) + 
  geom_vline(xintercept = 95.8, linetype = "dashed", color = "gray") +
  labs(x = "Distance to edge",
       y = "",
       title = "Distances to edge following prescribed fire",
       subtitle = "Only looking at birds in unburned compartments")

s22rx %>%
  mutate(burned = factor(burned, labels = c("Unburned", "Burned"))) %>%
  ggplot(aes(x = burned, y = distance_to_edge)) +
  geom_boxplot(fill = "midnight blue", alpha = 0.5) +
  labs(x = "Burn Status",
       y = "Distance to Edge",
       title = "Distance to edge of burn compartments following prescribed fire")

s22rx %>%
  mutate(burned = factor(burned, labels = c("Unburned", "Burned"))) %>%
  ggplot(aes(x = burned, y = distance_to_edge)) +
  geom_violin(fill = "midnight blue", alpha = 0.5) +
  labs(x = "Burn Status",
       y = "Distance to Edge",
       title = "Distance to edge following prescribed fire")

```


Making some plots of use of burned areas over time.
```{r}
#### Plotting use over time ####

#Average proportion of birds in burn areas each day, for each week.
ave_burned_per_week %>%
  mutate(week = (week - 15)) %>%
  dplyr::filter(week <=15) %>%
  ggplot(aes(week, mean_per_burned)) +
  geom_line() +
  labs(x = "Weeks following prescribed fire",
       y = "Mean percentage of birds online that were located in burned areas",
       title = "Average percentage of birds online that were located in burned areas each week")

#proportion of birds in burn areas each day.
s22rx %>%
  ggplot(aes(date, pib)) +
  geom_point() +
  geom_smooth(method = "loess") +
  scale_y_continuous(labels = percent) +
  labs(x = "Date",
       y = "% of birds in burned areas",
       title = "Percent of birds located in burned areas following prescribed fire")

```

Centering and scaling vegetation covariates
```{r}
#### Centering and scaling veg covariates.

s22rx_sc <- s22rx %>% 
  mutate_at(vars(pg:hs), .funs = function(x){as.numeric(scale(x, center = T))}) %>%
  mutate(pib = pib + 0.00001)
```

Checking for correlations 
```{r}
#### Checking for correlations ####
veg_only <- read_xlsx("/Volumes/Samsung_T5/BOBWHITE_DATA/Clean/VegSurveys/VegSurveys2022.xlsx") %>% 
  clean_names %>%
  select(percent_grasses:max_shrubs_cm)

#Before centering and scaling
cor(veg_only)

#After centering and scaling
csveg <- s22rx_sc %>%
  select(pg:hs)

cor(csveg)
```


Candidate models w beta distribution (post MDM meeting)
```{r}
#### Beta candidate models with beta distribution (post meeting) ####
#Global model
model1 <- betareg(pib ~ pg + pf + ps + hg + hf + DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")


model2 <- betareg(pib ~ DSF, 
                  data = s22rx_sc,
                  na.action = "na.pass")

model3<- betareg(pib ~ DSF + I(DSF^2), 
                  data = s22rx_sc,
                  na.action = "na.pass")

model4 <- betareg(pib ~ pg + pf + ps,
                  data = s22rx_sc,
                  na.action = "na.pass")

model5 <- betareg(pib ~ hg + hf + hs,
                  data = s22rx_sc,
                  na.action = "na.pass")


model6 <- betareg(pib ~ pg + hg + pf + hg,
                  data = s22rx_sc,
                  na.action = "na.pass")

model7 <- betareg(pib ~ ps,
                  data = s22rx_sc,
                  na.action = "na.pass")

model8 <- betareg(pib ~ 1,
                  data = s22rx_sc,
                  na.action = "na.pass")

```

Ranking candidate models
```{r}
#### ranking beta candidate models (post meeting) ####
# Creating a data frame to store model names and their AIC values
model_names <- c(paste0("model", 1:8))


model_list <- list(model1, model2, model3, model4,
                   model5, model6, model7, model8)


model_aic <- sapply(model_list, AIC)
model_nll <- sapply(model_list, logLik)

# Combine the model names and AIC values into a data frame
model_comparison <- data.frame(Model = model_names, AIC = model_aic, nll = - model_nll)

# Sort the models by AIC value
model_comparison_sorted <- model_comparison %>% 
  arrange(AIC)

# View the sorted data frame
model_comparison_sorted %>% 
  view()

# Calculate the minimum AIC value among all models
min_aic <- min(model_comparison_sorted$AIC)

# Add a column for Delta AIC
model_comparison_sorted <- model_comparison_sorted %>%
  mutate(Delta_AIC = AIC - min_aic)

# View the updated data frame
model_comparison_sorted %>% view()

model_comparison_sorted$rll <- exp(-0.5*model_comparison_sorted$Delta_AIC)
model_comparison_sorted$weight <- model_comparison_sorted$rll/sum(model_comparison_sorted$rll)
model_comparison_sorted$weight <- round(model_comparison_sorted$weight,3)

model_comparison_sorted %>% view()
#write_xlsx(model_comparison_sorted, "/Users/jeffgrayum/Downloads/model_comparison.xlsx")

plot(model5, which = 1:4, type = "pearson")
```


Candidate models (GAM)
```{r}
#### Candidate models (GAM) #### 

gmodel1 <- gam(pib ~ pg + pf + ps + hg + hf + DSF,
                     data = s22rx_sc,
                     family=betar(link = "logit"),
                     na.action = "na.pass")


gmodel2 <- gam(pib ~ DSF, 
                  data = s22rx_sc,
                  family = betar(link = "logit"),
                  na.action = "na.pass")

gmodel3 <- gam(pib ~ DSF + I(DSF^2), 
                  data = s22rx_sc,
                  family = betar(link = "logit"),
                  na.action = "na.pass")

gmodel4 <- gam(pib ~ pg + pf + ps,
                  data = s22rx_sc,
                  family = betar(link = "logit"),
                  na.action = "na.pass")

gmodel5 <- gam(pib ~ hg + hf + hs,
                  family = betar(link = "logit"),
                  data = s22rx_sc,
                  na.action = "na.pass")


gmodel6 <- gam(pib ~ pg + hg + pf + hg,
                  family = betar(link = "logit"),
                  data = s22rx_sc,
                  na.action = "na.pass")

gmodel7 <- gam(pib ~ ps,
                   family = betar(link = "logit"),
                  data = s22rx_sc,
                  na.action = "na.pass")

gmodel8 <- gam(pib ~ 1,
                  family = betar(link = "logit"),
                  data = s22rx_sc,
                  na.action = "na.pass")
```

```{r}
 #### Ranking gam models ####
# Creating a data frame to store model names and their AIC values
model_names <- c(paste0("gmodel", 1:8))


model_list <- list(gmodel1, gmodel2, gmodel3, gmodel4,
                   gmodel5, gmodel6, gmodel7, gmodel8)


model_aic <- sapply(model_list, AIC)
model_nll <- sapply(model_list, logLik)

# Combine the model names and AIC values into a data frame
model_comparison <- data.frame(Model = model_names, AIC = model_aic, nll = - model_nll)

# Sort the models by AIC value
model_comparison_sorted <- model_comparison %>% 
  arrange(AIC)

# View the sorted data frame
model_comparison_sorted %>% 
  view()

# Calculate the minimum AIC value among all models
min_aic <- min(model_comparison_sorted$AIC)

# Add a column for Delta AIC
model_comparison_sorted <- model_comparison_sorted %>%
  mutate(Delta_AIC = AIC - min_aic)

# View the updated data frame
model_comparison_sorted %>% view()

model_comparison_sorted$rll <- exp(-0.5*model_comparison_sorted$Delta_AIC)
model_comparison_sorted$weight <- model_comparison_sorted$rll/sum(model_comparison_sorted$rll)
model_comparison_sorted$weight <- round(model_comparison_sorted$weight,3)

model_comparison_sorted %>% view


```

```{r}
#### Plotting veg data vs percent in burned ####
s22rx_piv <- s22rx %>%
  select(pg:hs, pib) %>%
  pivot_longer(pg:hs, names_to = "Measurement", values_to = "Value")


s22rx_piv %>% 
  dplyr::filter(Measurement %in% c("pg", "pf", "ps")) %>%
  mutate(Measurement = factor(Measurement, levels = c("pg", "pf", "ps"))) %>%
  ggplot(aes(Value, pib)) +
  geom_point(color = "Midnight Blue") +
  facet_wrap(~ Measurement, scales = "free") +
  labs(x = "% cover",
       y = "% of birds in burned area",
       title = "Percent cover of grasses, forbs, and shrubs vs percent of birds in burned areas") +
  theme_bw()

s22rx_piv %>% 
  dplyr::filter(Measurement %in% c("hg", "hf", "hs")) %>%
  mutate(Measurement = factor(Measurement, levels = c("hg", "hf", "hs"))) %>%
  ggplot(aes(Value, pib)) +
  geom_point(color = "Midnight Blue") +
  facet_wrap(~ Measurement, scales = "free") +
  labs(x = "Height (cm)",
       y = "% of birds in burned area",
       title = "Height of grasses, forbs and shrubs vs percent of birds in burned areas") +
  theme_bw()


s22rx %>%
  ggplot(aes(pg, pib)) +
  geom_point(color = "Midnight Blue") +
  labs(x = "% cover of grasses",
       y = "Perenct of birds in burned area",
       title = "Percent cover grasses vs Percent of birds in burned areas") +
  theme_bw()

s22rx %>%
  ggplot(aes(pf, pib)) +
  geom_point(color = "Midnight Blue") +
  labs(x = "% cover of forbs",
       y = "Perenct of birds in burned area",
       title = "Percent cover forbs vs Percent of birds in burned areas") +
  theme_bw()


s22rx %>%
  ggplot(aes(ps, pib)) +
  geom_point(color = "Midnight Blue") +
  labs(x = "% cover of shrubs",
       y = "Perenct of birds in burned area",
       title = "Percent cover shrubs vs Percent of birds in burned areas")

s22rx %>%
  ggplot(aes(hg, pib)) +
  geom_point(color = "Midnight Blue") +
  labs(x = "Height of grasses (cm)",
       y = "Perenct of birds in burned area",
       title = "Height of grasses vs Percent of birds in burned areas")

s22rx %>%
  ggplot(aes(hf, pib)) +
  geom_point(color = "Midnight Blue") +
  labs(x = "Height of forbs (cm)",
       y = "Perenct of birds in burned area",
       title = "Height of forbs vs Percent of birds in burned areas")

s22rx %>%
  ggplot(aes(hs, pib)) +
  geom_point(color = "Midnight Blue") +
  labs(x = "Height of shrubs (cm)",
       y = "Perenct of birds in burned area",
       title = "Height of shrubs vs Percent of birds in burned areas")
  
```

Making predict plots with top model
```{r}
#### Making predict plots ####

#First, we will calculate the mean values for hg, hf, and hs. Two of these will be held constant when making predict plots for other covariate.
mean_hg <- mean(s22rx_sc$hg)
mean_hf <- mean(s22rx_sc$hf)
mean_hs <- mean(s22rx_sc$hs)

#First we will do height of grasses. We need to create a new data frame with sequence of grass height(between min a max), and the mean values of hf and hs.

# Generate a sequence of hg values, between min and max.
hg_values <- seq(min(s22rx_sc$hg, na.rm = TRUE), 
                 max(s22rx_sc$hg, na.rm = TRUE), 
                 length.out = 1000) 


# we must create a data frame with the hg values, and the mean hf and hs values
hgdf <- data.frame(
  hg = hg_values, 
  hf = rep(mean_hf, length(hg_values)), 
  hs = rep(mean_hs, length(hg_values))
)

# Generating predictions and variance of predictions.
hg_pred <- data.frame(predict(model5, newdata = hgdf, type = "response", se.fit = TRUE))

hg_pred$hg_values <- hg_values

#head(hg_pred)

hg_pred$lowCI = (hg_pred$fit - (1.96 * hg_pred$se.fit))
hg_pred$upperCI = (hg_pred$fit + (1.96 * hg_pred$se.fit))

hg_pred %>%
  ggplot(aes(hg_values, fit)) +
  geom_line() +
  geom_ribbon(aes(ymin = lowCI, ymax = upperCI), fill = "blue", alpha = 0.1) +
  labs(x = "Height of grasses (centered and scaled)",
       y = "Predicted % NOBO in burned areas",
       title = "Predicted % NOBO in burned areas vs height of grasses") +
  scale_y_continuous(labels = percent)

#Now, we will do hf.
#Generate a sequence of hf values, between min and max.
hf_values <- seq(min(s22rx_sc$hf, na.rm = TRUE), 
                 max(s22rx_sc$hf, na.rm = TRUE), 
                 length.out = 300) 


#We must create a data frame with the hg values, and the mean hf and hs values
hfdf <- data.frame(
  hg = rep(mean_hg, length(hf_values)), 
  hf = hf_values, 
  hs = rep(mean_hs, length(hf_values))
)

# Generate predictions
hf_pred <- data.frame(predict(model5, newdata = hfdf, type = "response", se.fit = TRUE))

hf_pred$hf_values <- hf_values

hf_pred$lowCI = (hf_pred$fit - (1.96 * hf_pred$se.fit))
hf_pred$upperCI = (hf_pred$fit + (1.96 * hf_pred$se.fit))

# Plotting
hf_pred%>% 
  ggplot(aes(hf_values, fit)) +
  geom_line() +
  geom_ribbon(aes(ymin = lowCI, ymax = upperCI), fill = "blue", alpha = 0.1) +
  labs(x = "Height of forbs (centered and scaled)",
       y = "Predicted % NOBO in burned areas",
       title = "Predicted % NOBO in burned areas vs height of forbs") +
  scale_y_continuous(labels = percent)



#Now, we will do hs.
# Generate a sequence of hf values, between min and max.
hs_values <- seq(min(s22rx_sc$hs, na.rm = TRUE), 
                 max(s22rx_sc$hs, na.rm = TRUE), 
                 length.out = 1000) 


# we must create a data frame with the hg values, and the mean hf and hs values
hsdf <- data.frame(
  hg = rep(mean_hg, length(hs_values)), 
  hf = rep(mean_hf, length(hs_values)), 
  hs = hs_values)


# Generate predictions
hs_pred <- data.frame(predict(model5, newdata = hsdf, type = "response", se.fit = TRUE))


#Calculating upper and lower confidence intervals
hs_pred$lowCI = (hs_pred$fit - (1.96 * hs_pred$se.fit))
hs_pred$upperCI = (hs_pred$fit + (1.96 * hs_pred$se.fit))


# Plotting
hs_pred%>% 
  ggplot(aes(hs_values, fit)) +
  geom_line() +
  geom_ribbon(aes(ymin = lowCI, ymax = upperCI), fill = "blue", alpha = 0.1) +
  labs(x = "Height of shrubs (centered and scaled)",
       y = "Predicted % NOBO in burned areas",
       title = "Predicted % NOBO in burned areas vs height of shrubs") +
  scale_y_continuous(labels = percent)



#Now, we will do hs.
# Generate a sequence of hf values, between min and max.
hs_values <- seq(min(s22rx_sc$hs, na.rm = TRUE), 
                 max(s22rx_sc$hs, na.rm = TRUE), 
                 length.out = 300) 


# we must create a data frame with the hg values, and the mean hf and hs values
hsdf <- data.frame(
  hg = rep(mean_hg, length(hs_values)), 
  hf = rep(mean_hf, length(hs_values)), 
  hs = hs_values)


# Generate predictions
hs_mean <- predict(model5, newdata = hsdf, type = "response")
hs_var <- predict(model5, newdata = hsdf, type = "variance")

head(hs_mean)

#Creating new dataframe with hs mean predictions, and variance
hs_results_df <- data.frame(
  hs_mean = hs_mean,
  hs_var = hs_var
)

#Calculating upper and lower confidence intervals
hs_results_df$lowCI = (hs_results_df$hs_mean - (1.96 * sqrt(hs_results_df$hs_var)))
hs_results_df$upperCI = (hs_results_df$hs_mean + (1.96 * sqrt(hs_results_df$hs_var)))

head(hs_results_df)

# Plotting
hs_results_df %>% 
  ggplot(aes(hs_values, hs_mean)) +
  geom_line() +
  geom_ribbon(aes(ymin = lowCI, ymax = upperCI), fill = "blue", alpha = 0.1) +
  labs(x = "Height of shrubs (centered and scaled)",
       y = "Predicted % NOBO in burned areas",
       title = "Predicted % NOBO in burned areas vs height of shrubs") +
  scale_y_continuous(labels = percent)


```


Old Beta Models (too much like dredge... minimal ecological difference between models.)
```{r}
#### Old beta models ####

null <- betareg(pib ~ 1,
                data = summer_locs_veg_data_perc_burned_modified,
                na.action = "na.pass")
                     
AIC(null)

# Model 1 (all veg influences veg)
model1 <- betareg(pib ~
                     pg +
                     pf +
                     ps + 
                     hg + 
                     hf,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

# Model 2 (only looking at herbaceous veg components)
model2 <- betareg(pib ~
                     pg +
                     pf +
                     hg + 
                     hf,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

# Model 3 only grass influences use
model3 <- betareg(pib ~
                     pg + 
                     hg,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

# Model 4 only forbs influence use 
model4 <- betareg(pib ~
                     pf +  
                     hf,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

# Model 5 Height of herbaceous veg influencing use
model5 <- betareg(pib ~
                     hg + 
                     hf,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

# Model 6 percent of cover of herb veg influencing use
model6 <- betareg(pib ~
                     pg + 
                     pf +  
                     hg + 
                     hf,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 7, pecent grasses influence use 
model7 <- betareg(pib ~
                     pg,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 8, height grasses influence use 
model7 <- betareg(pib ~
                     hg,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#model 8, perc forbs influences use
model8 <- betareg(pib ~
                     pf,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 9, height forbs influences use 
model9 <- betareg(pib ~
                     hf,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

# Model 10 Shrubby height and cover influences use
model10 <- betareg(pib ~
                     ps +
                     hs,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 11 percent of shrubs is most influential
model11 <- betareg(pib ~
                     ps,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 12 height of shurbs is most influential
model12 <- betareg(pib ~
                     hs,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 13 Height of all veg cover most influences use.
model13 <- betareg(pib ~
                     hg +
                     hf +
                     hs,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 14 percent cover of all veg cover most influences use.
model14 <- betareg(pib ~
                     pg +
                     pf +
                     ps,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#model 15 Height of grasses, percent forbs (grow "out" more than "up"), and height of shrubs.
model15 <- betareg(pib ~
                     hg +
                     pf +
                     hs,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 16, same as above, but percent shrubs may be more influential with this combination.
model16 <- betareg(pib ~
                     hg +
                     pf +
                     ps,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 17, percent grasses, percent forbs, and height shrubs
model17 <- betareg(pib ~
                     pg +
                     pf +
                     hs,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#model 18, only height grasses and height shrubs (vertical cover)
model18 <- betareg(pib ~
                     hg +
                     hs,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 19, horizontal cover from forbs, vertical from shrubs
model19 <- betareg(pib ~
                     pf +
                     hs,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 20, horizontal cover from forbs, vertical from grass
model20 <- betareg(pib ~
                     pf +
                     hg,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 21, height of grasses and shrubs
model21 <- betareg(pib ~
                     hg +
                     hs,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     


# Model 22 (only looking at herbaceous veg components, but with DSF)
model22 <- betareg(pib ~
                     pg +
                     pf +
                     hg + 
                     hf +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

# Model 23 only grass influences use, along with DSF
model23 <- betareg(pib ~
                     pg + 
                     hg +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

# Model 24 only forbs influence use, plus DSF
model24 <- betareg(pib ~
                     pf +  
                     hf +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

# Model 25 Height of herbaceous veg influencing use, plus DSF
model25 <- betareg(pib ~
                     hg + 
                     hf +
                     DSF, 
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

# Model 26 percent of cover of herb veg influencing use, along with DSF
model26 <- betareg(pib ~
                     pg + 
                     pf +  
                     hg + 
                     hf +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 27, percent grasses influence use, plus DSF
model27 <- betareg(pib ~
                     pg +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 28, height grasses influence use, plus DSF
model28 <- betareg(pib ~
                     hg +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#model 29, perc forbs influences use, including DSF
model29 <- betareg(pib ~
                     pf +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 30, height forbs influences use 
model30 <- betareg(pib ~
                     hf +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

# Model 31 Shrubby height and cover influences use, including DSF
model31 <- betareg(pib ~
                     ps +
                     #hs +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 32 percent of shrubs is most influential, including DSF
model32 <- betareg(pib ~
                     ps +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 33 height of shurbs is most influential, along with DSF
model33 <- betareg(pib ~
                     hs +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 34 Height of all veg cover most influences use, including DSF.
model34 <- betareg(pib ~
                     hg +
                     hf +
                     hs +
                     DSF, 
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 35 percent cover of all veg cover most influences use, with DSF.
model35 <- betareg(pib ~
                     pg +
                     pf +
                     ps +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#model 36 Height of grasses, percent forbs (grow "out" more than "up"), and height of shrubs. Also, DSF
model36 <- betareg(pib ~
                     hg +
                     pf +
                     hs +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")


#Model 37, same as above, but percent shrubs may be more influential with this combination. Including DSF this time
model37 <- betareg(pib ~
                     hg +
                     pf +
                     ps +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 38, percent grasses, percent forbs, and height shrubs. Plus DSF
model38 <- betareg(pib ~
                     pg +
                     pf +
                     hs +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#model 39, only height grasses and height shrubs (vertical cover). With DSF.
model39 <- betareg(pib ~
                     hg +
                     hs +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 40, horizontal cover from forbs, vertical from shrubs. Including DSF
model40 <- betareg(pib ~
                     pf +
                     hs +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 41, horizontal cover from forbs, vertical from grass. Including DSF
model41 <- betareg(pib ~
                     pf +
                     hg +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 42, height of grasses and shrubs, plus DSF
model42 <- betareg(pib ~
                     pf +
                     hg +
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 43, all veg except height grass. Maybe vertical cover from thin blades of grass isn't important. With this many veg covariates, DSF may not be important.
model43 <- betareg(pib ~
                     pg +
                     pf +
                     ps + 
                     hf + 
                     hs,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 44, all veg except height grass height forbs. Maybe forbs provide better horizontal cover
model44 <- betareg(pib ~
                     pg +
                     pf +
                     hg + 
                     hs,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#Model 45, all veg except height grass height forbs. Maybe forbs provide better horizontal cover
model45 <- betareg(pib ~
                     pg +
                     pf +
                     ps +
                     hs,
                     data = s22rx_sc,
                     na.action = "na.pass")
                     

#model 46, only DSF
model46 <- betareg(pib ~
                     DSF,
                     data = s22rx_sc,
                     na.action = "na.pass")

#model 47, only DSF
model47 <- betareg(pib ~
                     DSF +I(DSF^2),
                     data = s22rx_sc,
                     na.action = "na.pass")

summary(model46)
                     


Now looking at all models with binomial distribution
```{r}
#### candidate models, binomial distribution ####
#Global model
globalmodel <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg +
                     pf +
                     ps +    
                     hg + 
                     hf + 
                     DSF,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 1
model1 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg +
                     pf +
                     ps + 
                     hg + 
                     hf,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 2
model2 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg +
                     pf +
                     hg + 
                     hf,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 3
model3 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg + 
                     hg,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 4
model4 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pf +  
                     hf,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 5
model5 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hg + 
                     hf,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 6
model6 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg + 
                     pf +  
                     hg + 
                     hf,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 7
model7 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 8
model8 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pf,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 9
model9 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hf,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 10
model10 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     ps +
                     hs,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 11
model11 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     ps,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 12
model12 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hs,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 13
model13 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hg +
                     hf +
                     hs,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 14
model14 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg +
                     pf +
                     ps,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 15
model15 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hg +
                     pf +
                     hs,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 16
model16 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hg +
                     pf +
                     ps,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 17
model17 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg +
                     pf +
                     hs,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 18
model18 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hg +
                     hs,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 19
model19 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pf +
                     hs,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")

# Model 20
model20 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pf +
                     hg,
                     data = s22rx_sc,
                     family = binomial,
                     na.action = "na.pass")


#Model 21, height of grasses and shrubs
model21 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hg +
                     hs,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 22 (only looking at herbaceous veg components, but with DSF)
model22 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg +
                     pf +
                     hg + 
                     hf +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 23 only grass influences use, along with DSF
model23 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg + 
                     hg +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 24 only forbs influence use, plus DSF
model24 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pf +  
                     hf +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 25 Height of herbaceous veg influencing use, plus DSF
model25 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hg + 
                     hf +
                     DSF, 
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 26 percent of cover of herb veg influencing use, along with DSF
model26 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg + 
                     pf +  
                     hg + 
                     hf +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 27, percent grasses influence use, plus DSF
model27 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 28, height grasses influence use, plus DSF
model28 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hg +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 29, perc forbs influences use, including DSF
model29 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pf +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 30, height forbs influences use 
model30 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hf +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 31 Shrubby height and cover influences use, including DSF
model31 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     ps +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 32 percent of shrubs is most influential, including DSF
model32 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     ps +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 33 height of shurbs is most influential, along with DSF
model33 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hs +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 34 Height of all veg cover most influences use, including DSF.
model34 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hg +
                     hf +
                     hs +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 35 percent cover of all veg cover most influences use, with DSF.
model35 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg +
                     pf +
                     ps +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 36 Height of grasses, percent forbs (grow "out" more than "up"), and height of shrubs. Also, DSF
model36 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hg +
                     pf +
                     hs +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 37, same as above, but percent shrubs may be more influential with this combination. Including DSF this time
model37 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hg +
                     pf +
                     ps +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 38, percent grasses, percent forbs, and height shrubs. Plus DSF
model38 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg +
                     pf +
                     hs +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 39, only height grasses and height shrubs (vertical cover). With DSF.
model39 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hg +
                     hs +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 40, only percent grasses and percent shrubs (horizontal cover). Including DSF.
model40 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg +
                     ps +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 41, grasses and shrubs
model41 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg +
                     ps +  
                     hg + 
                     hs +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")


# Model 42, height of grasses, height of forbs, and percent shrubs, plus DSF
model42 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hg +
                     hf +
                     ps +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 43, height of grasses, percent forbs, and percent shrubs, plus DSF
model43 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     hg +
                     pf +
                     ps +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 44, percent grasses, height of forbs, and height of shrubs, plus DSF
model44 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg +
                     hf +
                     hs +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 45, percent grasses, percent forbs, and height of shrubs. Plus DSF.
model45 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg +
                     pf +
                     hs +
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")

# Model 46, only DSF
model46 <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     DSF,
                     family = binomial, data = s22rx_sc, na.action = "na.pass")


```

Looking at results of binomial models
```{r}
#### ranking binomial models ####
# Creating a data frame to store model names and their AIC values
model_names <- c("globalmodel", paste0("model", 1:46))


model_list <- list(globalmodel, model1, model2, model3, model4,
                   model5, model6, model7, model8, model9,
                   model10, model11, model12, model13, model14,
                   model15, model16, model17, model18, model19,
                   model20, model21, model22, model23, model24,
                   model25, model26, model27, model28, model29,
                   model30, model31, model32, model33, model34,
                   model35, model36, model37, model38, model39,
                   model40, model41, model42, model43, model44, model45, model46)


model_aic <- sapply(model_list, AIC)

# Combine the model names and AIC values into a data frame
model_comparison <- data.frame(Model = model_names, AIC = model_aic)

# Sort the models by AIC value
model_comparison_sorted <- model_comparison %>% 
  arrange(AIC)

# View the sorted data frame
model_comparison_sorted %>% 
  view()

# Calculate the minimum AIC value among all models
min_aic <- min(model_comparison_sorted$AIC)

# Add a column for Delta AIC
model_comparison_sorted <- model_comparison_sorted %>%
  mutate(Delta_AIC = AIC - min_aic)

# View the updated data frame
model_comparison_sorted %>% view()
```

Cross validating top model (binomial)
```{r}

# Partitioning data into training (80% ) and testing sets 
set.seed(123)
trainIndex <- createDataPartition(s22rx_sc$pib, p = .8, list = FALSE)
trainData <- s22rx_sc[trainIndex,]
testData  <- s22rx_sc[-trainIndex,]

# Example code for fitting a binomial model on training data
fit_binomial <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~ pg + ps + hg + hs + DSF,
                    data = trainData, family = binomial, na.action = na.pass)

# k-fold cross-validation (e.g., 10-fold)
ctrl <- trainControl(method = "cv", number = 10)

train_binomial <- glm(cbind(birds_in_burned_areas, birds_online - birds_in_burned_areas) ~
                     pg +
                     ps +  
                     hg + 
                     hs +
                     DSF,
                     family = binomial, data = trainData, na.action = "na.pass")


testData_new <- testData[,c("pg","ps","hg","hs","DSF")]
# Evaluating the model on the test set, creating a confusion matrix
predictions <- predict(train_binomial, newdata = testData, type = "response")





plot(predictions - (testData$birds_in_burned_areas)/testData$birds_online)
mtext("Binomial: Predictions - Observed values", outer = TRUE, line = -1, cex = 1.5)

mean_binomial <- mean(predictions - (testData$birds_in_burned_areas)/testData$birds_online)
```

```{r}
# Partitioning data into training (80% ) and testing sets 
set.seed(123)
trainIndex <- createDataPartition(s22rx_sc$pib, p = .8, list = FALSE)
trainData <- s22rx_sc[trainIndex,]
testData  <- s22rx_sc[-trainIndex,]

# Example code for fitting a binomial model on training data
fit_beta <- betareg(pib ~  hg + pf + hs + DSF,
                    data = trainData, na.action = na.pass)

# k-fold cross-validation (e.g., 10-fold)
ctrl <- trainControl(method = "cv", number = 10)

train_beta <- betareg(pib ~
                     hg +
                     pf +
                     hs +
                     DSF,
                     data = trainData,
                     na.action = "na.pass")



testData_new <- testData[,c("pg","ps","hg","hs","DSF")]
# Evaluating the model on the test set, creating a confusion matrix
predictions <- predict(train_beta, newdata = testData, type = "response")


plot(predictions - (testData$birds_in_burned_areas)/testData$birds_online)
mtext("Beta: Predictions - Observed values", outer = TRUE, line = -1, cex = 1.5)

mean_beta <- mean(predictions - (testData$birds_in_burned_areas)/testData$birds_online)

```

```{r}
library(caret)

set.seed(123)
trainIndex <- createDataPartition(s22rx_sc$pib, p = .8, list = FALSE)
trainData <- s22rx_sc[trainIndex,]
testData  <- s22rx_sc[-trainIndex,]

as.numeric(caret::RMSE(s22rx_sc$pib, predict(model34, newdata = testData)))

```

testing data, Darren's script
```{r}
#### Testing data, Darren's script ####

library(glmnet)
library(caret)
library(performance)
library(betareg)

#scale data 

dat <- s22rx 

dat2 = dat #version control since I'm about to modify the dataframe
dat2[15:21] = scale(dat2[15:21], center = T, scale = T)

#Create Data Partition

train = createDataPartition(dat$pib, p = 0.8, list = F) #use caret to maintain distribution of response variable
train_set = dat[train,]
test_set = dat[-train,]

#build binomial model 

bi_model = glm(pib ~ hg + hf + hs, 
                  family = binomial(link = 'probit'), data = train_set)
summary(bi_model) #glm is PICKY and will throw a warning, but bi_model will fit

#evaluation using performance package

check_model(bi_model)
check_distribution(bi_model)
plot(check_distribution(bi_model))

#predictions

pred_rmse = as.numeric(caret::RMSE(dat2$pib, predict(bi_model, newdata = test_set)))
pred_rmse

#build binomial model with logit link

bi_model2 = glm(pib ~ hg + hf + hs, 
               family = binomial(link = 'logit'), data = train_set)
summary(bi_model2)

#evaluation

check_model(bi_model2)
check_distribution(bi_model2)
plot(check_distribution(bi_model2))

#predictions

pred_bi2 = as.numeric(caret::RMSE(dat2$pib, predict(bi_model, newdata = test_set)))
pred_bi2 #changing logit to probit didn't change anything

#build model using beta distribution
#this did not function without adding the 0.0000001, but you can compare all of your models using the above method

be_model = betareg(pib ~ hg + hf + hs + hg, data = train_set)

summary(be_model) #glm is PICKY and will throw a warning, but bi_model will fit

#evaluation using performance package

check_model(be_model)
check_distribution(be_model)
plot(check_distribution(be_model))

#predictions

pred_rmse = as.numeric(caret::RMSE(dat2$pib, predict(be_model, newdata = test_set)))
pred_rmse
```



